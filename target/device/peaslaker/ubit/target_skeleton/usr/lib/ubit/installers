_get () {
	local MIRROR=http://jeff.doozan.com/debian/goflex
	local output
	[ ${2} ] && output="-O ${2}"

	if ( wget -s ${MIRROR}/${1} ); then
		rm ${2}
		wget -s ${MIRROR}/$1 ${output}
	fi
}


kernel_nand_installer () {
	_get v0.6/checksum.md5

	if ! ( md5sum -c checksum.md5 ); then
		_get v0.5/v2.6.37/boot.tar.gz
		_get v0.5/v2.6.37/modules.tar.gz
		_get v0.6/uInitrd

		tar -xzf boot.tar.gz
	fi
	# Checksum the source files
	if ( md5sum -c checksum.md5 ); then
		kernel

		# this sets up the installer script that will run on reboot
		{ 
		echo on /dev/sda1 ready_prepared
		echo ubiformat_mtd3
		echo on /dev/sda1 install
		} > .ubit.boot
		echo The installer script has been set up at .ubit.boot
	else
		echo The download stage failed with a mismatched checksum.  Aborting install
	fi
}

plugbox_nand_installer () {
	_get v0.6/checksum.md5

	if ! ( md5sum -c checksum.md5 ); then
		_get v0.5/v2.6.37/boot.tar.gz
		_get v0.5/v2.6.37/modules.tar.gz
		_get v0.6/uInitrd

		tar -xzf boot.tar.gz
	fi

	#Copy the Plugbox rootfs tarball to the install disk
	wget http://plugapps.com/os/1.1/Plugbox-Linux-1.1-rootfs.tar.gz -O rootfs.tar.gz

	if ( md5sum -c checksum.md5 ); then
		prepare

		# this sets up the installer script that will run on reboot
		{ 
		echo on /dev/sda1 ready_prepared
		echo ubiformat_mtd3
		echo on /dev/sda1 install
		} > .ubit.boot
		echo The installer script has been set up at .ubit.boot
	else
		echo The download stage failed with a mismatched checksum.  Aborting install
	fi
}



