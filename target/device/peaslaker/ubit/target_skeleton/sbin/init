#!/bin/ash
export PATH="/usr/sbin:/usr/bin:/sbin:/bin"

/bin/busybox mount -t proc proc	/proc	
/bin/busybox mount -t sysfs sys	/sys
/bin/busybox --install -s

echo "/sbin/mdev" > /proc/sys/kernel/hotplug		# mdev handles hotplug events
mkdir /dev/shm
/sbin/mdev -s		# have mdev populate /dev
ln -s /proc/mounts /etc/mtab

#	if [ ! -e /dev/md0 ]; then
#		makedevs	/dev/md		b 9 0 0 7
#		fi


echo none > /sys/class/leds/status\:orange\:misc/trigger
echo none > /sys/class/leds/status\:green\:health/trigger

mkdir /workarea /tmp

cd /workarea

	# make us look busy
	echo timer > /sys/class/leds/status\:orange\:misc/trigger
	echo 100 > /sys/class/leds/status\:orange\:misc/delay_off
	echo 100 > /sys/class/leds/status\:orange\:misc/delay_on

# returns having set a mountpoint in which we will try to boot
. /init.rootmount

echo "Executing switch_root and spawning init"
# Reset environment
echo "" > /proc/sys/kernel/hotplug

	# the ramdisk has finished so we switch the lights out
	echo none > /sys/class/leds/status\:orange\:misc/trigger

bootargs=`cat /proc/cmdline`
umount /sys
umount /proc
mv /dev/null dev 
mv /dev/console dev
mv /dev/tty1 dev 
exec /bin/busybox switch_root . /sbin/init $bootargs

	# We should never get here, but if we do...

	
