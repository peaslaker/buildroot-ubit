#!/bin/bash
dd if=../u-boot/u-boot.kwb of=output/target/ubit.kwb bs=512K conv=sync
cp ../u-boot/tools/env/fw_env.config  output/target/etc/
(	cd output/target
	mkdir -p proc
	mkdir -p sys
	cat ubit.kwb | md5sum > valid.ubit.md5
	md5sum ubit.kwb >> kwb.md5
	touch .ubit.ubimounts
	touch .ubit.extramounts
	touch .ubit.images
	touch .ubit.rename
	touch .ubit.password
	find . | cut -d'.' -f 2- > cpio_list
	find . | cpio -H newc -o | gzip > ../images/rootfs.cpio.gz
	)

ver=`cat output/target/etc/issue`

mkimage -A arm -O linux -T ramdisk -a 0x0 -e 0x0 -n "${ver}" -d output/images/rootfs.cpio.gz output/images/uInitrd 
